<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus-7: Genesis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Roboto', sans-serif; background-color: #1a202c; color: #e2e8f0; overflow-x: hidden; }
        .font-orbitron { font-family: 'Orbitron', sans-serif; }
        .resource-bar, .main-content-wrapper, .footer { /* .main-content renommé en .main-content-wrapper */
            border: 1px solid #4a5568; border-radius: 0.5rem;
            background-color: #2d3748;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
        }
        .btn { transition: all 0.3s ease; border-radius: 0.375rem; padding: 0.5rem 1rem; font-weight: 600; }
        .btn-sm { padding: 0.25rem 0.5rem; font-size: 0.875rem; }
        .btn-xs { padding: 0.125rem 0.3rem; font-size: 0.75rem; }
        .btn-primary { background-color: #4299e1; color: white; } .btn-primary:hover { background-color: #3182ce; }
        .btn-secondary { background-color: #4a5568; color: #e2e8f0; } .btn-secondary:hover { background-color: #2d3748; }
        .btn-danger { background-color: #e53e3e; color: white; } .btn-danger:hover { background-color: #c53030; }
        .btn-success { background-color: #48bb78; color: white; } .btn-success:hover { background-color: #38a169; }
        .btn-warning { background-color: #ecc94b; color: #1a202c; } .btn-warning:hover { background-color: #d69e2e; }
        .btn-info { background-color: #63b3ed; color: white; } .btn-info:hover { background-color: #4299e1;}
        .btn-disabled { background-color: #718096; color: #a0aec0; cursor: not-allowed; }
        .panel { background-color: #2d3748; border: 1px solid #4a5568; border-radius: 0.5rem; padding: 1rem; margin-bottom: 1rem; }

        ::-webkit-scrollbar { width: 8px; height: 8px; } ::-webkit-scrollbar-track { background: #2d3748; border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: #4a5568; border-radius: 10px; } ::-webkit-scrollbar-thumb:hover { background: #718096; }

        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); display: flex; justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background-color: #2d3748; padding: 2rem; border-radius: 0.5rem; border: 1px solid #4a5568; min-width: 300px; max-width: 90%; }

        /* Styles pour la disposition principale avec menu rétractable */
        .main-content-wrapper {
            display: flex;
            gap: 1rem; /* Espace entre le menu et le contenu principal */
        }
        #buildings-section {
            flex: 0 0 320px; /* Largeur fixe pour le menu de gauche, ne grandit pas, ne rétrécit pas */
            transition: margin-left 0.3s ease-in-out, width 0.3s ease-in-out, opacity 0.3s ease-in-out;
            max-height: calc(100vh - 180px); /* Hauteur maximale pour le scroll interne */
            overflow-y: auto;
        }
        #buildings-section.hidden-menu {
            margin-left: -320px; /* Cache le menu en le déplaçant hors de l'écran */
            opacity: 0;
            width: 0; /* Réduit la largeur à 0 pour que l'espace ne soit pas réservé */
            padding:0; margin-right:0; border:0;
        }
        #main-view-section-container { /* Nouveau conteneur pour la vue principale */
            flex-grow: 1; /* Prend l'espace restant */
            display: flex;
            flex-direction: column;
        }
        #main-view-section {
            flex-grow: 1; /* Permet à cette section de remplir le conteneur */
            max-height: calc(100vh - 180px); /* Hauteur maximale pour le scroll interne */
            overflow-y: auto;
        }
        #toggle-menu-btn-container { /* Pour positionner le bouton de bascule */
            position: fixed; /* Ou absolute si relatif à un parent positionné */
            top: 110px; /* Ajustez selon la hauteur de votre header */
            left: 10px;
            z-index: 50; /* Au-dessus du contenu mais sous les modales */
        }
        #toggle-menu-btn {
             background-color: #4a5568;
             color: #e2e8f0;
        }


        /* ... (vos autres styles comme .nanobot-display, .map-tile, etc.) ... */

        /* Styles pour Exploration Tab */
        #exploration-layout {
            display: flex; /* Changé de grid à flex pour mieux contrôler les colonnes */
            flex-direction: column; /* Défaut pour mobile */
            gap: 1rem;
        }
        @media (min-width: 768px) { /* md breakpoint de Tailwind */
            #exploration-layout {
                flex-direction: row; /* Lignes pour desktop */
            }
        }

        #exploration-main-column {
            flex-grow: 1; /* Prend plus de place */
            display: flex;
            flex-direction: column; /* Pour empiler zone-selection, map-area, map-info */
             min-width: 0; /* Important pour flexbox pour éviter le débordement */
        }
        @media (min-width: 768px) {
            #exploration-main-column {
                /* Sur desktop, elle prendra 3/4 par défaut si la sidebar prend 1/4 */
            }
        }


        #exploration-map-area {
            display: flex; /* Permet à exploration-content-container de se centrer ou de s'étirer */
            flex-direction: column;
            overflow: auto;
            max-height: 65vh; /* Ajusté pour laisser de la place au log/details */
            border: 1px solid #3a4558;
            border-radius: 0.25rem;
            padding: 0.5rem;
            background-color: #222938;
            flex-grow: 1; /* Pour qu'elle prenne l'espace disponible dans sa colonne */
        }
        #exploration-content-container {
            display: flex;
            flex-direction: column;
            align-items: center; /* Centre la grille et le bouton scan horizontalement */
            width: 100%; /* S'assure qu'il prend la largeur de map-area */
        }
        #map-grid {
            display: grid;
            gap: 1px;
            background-color: #1a202c;
            border: 1px solid #3a4558;
            margin-bottom: 1rem; /* Espace entre la grille et le bouton scan */
        }
        .map-tile {
            width: 25px;
            height: 25px;
            font-size: 1rem;
            /* ... autres styles .map-tile */
        }
        #map-info { text-align: center; font-size: 0.9rem; margin-top: 0.5rem; }

        #exploration-sidebar {
            display: flex;
            flex-direction: column;
            min-width: 0; /* Important pour flexbox */
        }
        @media (min-width: 768px) {
            #exploration-sidebar {
                width: 300px; /* Largeur fixe pour la sidebar sur desktop */
                flex-shrink: 0; /* Empêche la sidebar de rétrécir */
                max-height: calc(100vh - 200px); /* Pour permettre le scroll interne si nécessaire */
                overflow-y: auto;
            }
        }
        #exploration-log {
            background-color: #1a202c; border: 1px solid #4a5568;
            border-radius: 0.375rem; padding: 0.75rem;
            height: 200px; /* Hauteur fixe pour le log */
            overflow-y: auto;
            font-size: 0.8rem; color: #cbd5e0;
            font-family: 'Roboto Mono', monospace; line-height: 1.4;
            margin-bottom: 1rem; /* Espace avant le panneau de détails */
        }
        #tile-interaction-panel {
            background-color: #1a202c; border: 1px solid #4a5568;
            border-radius: 0.375rem; padding: 1rem;
            flex-grow: 1; display: flex; flex-direction: column;
        }

        /* ... (Le reste de vos styles : .nanobot-display, .combat-*, .base-preview-*, etc. restent inchangés) ... */
        .nanobot-display { width: 150px; height: 200px; margin: 10px auto; position: relative; border: 2px solid #4a5568; background-color: #1a202c; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .nanobot-core { width: 50px; height: 50px; background-color: #63b3ed; border: 2px solid #2c5282; box-shadow: 0 0 5px #63b3ed; position: relative; }
        .nanobot-module, .nanobot-item-visual { position: absolute; background-color: #a0aec0; border: 1px solid #718096; }
        .module-arm-blade { width: 60px; height: 10px; background-color: #e53e3e; top: 20px; left: -65px; transform: rotate(-30deg); }
        .module-legs-antigrav { width: 20px; height: 30px; background-color: #48bb78; bottom: -35px; }
        .module-legs-antigrav.left { left: 0px; } .module-legs-antigrav.right { right: 0px; }
        .module-shield { position: absolute; top: -10px; left: -10px; right: -10px; bottom: -10px; border: 3px dashed #4299e1; border-radius: 5px; animation: pulse-shield 2s infinite; }
        @keyframes pulse-shield { 0%, 100% { opacity: 0.5; } 50% { opacity: 1; } }
        .item-weapon-laser { width: 70px; height: 8px; background: linear-gradient(to right, red, orange); top: 21px; right: -75px; transform: rotate(20deg); }
        .item-armor-plating { width: 55px; height: 55px; border: 3px solid #90cdf4; border-radius: 5px; top: -4px; left: -4px; opacity:0.7; }

        #combat-modal-content { min-width: 80vw; max-width: 600px; min-height: 50vh; }
        .combat-arena { display: flex; justify-content: space-around; align-items: flex-end; height: 250px; background-color: #1a202c; border: 1px solid #4a5568; border-radius: 0.25rem; padding: 20px; margin-bottom: 1rem; position: relative; overflow: hidden;}
        .combatant { position: relative; text-align: center; transition: transform 0.3s ease-out; }
        .combatant-sprite { width: 80px; height: 100px; border: 2px solid #4a5568; margin: 0 auto; position: relative; background-size: contain; background-repeat: no-repeat; background-position: center; }
        #combat-nanobot-sprite { background-color: #63b3ed; } #combat-enemy-sprite { background-color: #e53e3e; }
        .combatant-name { font-weight: bold; margin-bottom: 5px; font-size: 0.875rem; }
        .health-bar-container { width: 80px; height: 10px; background-color: #718096; border-radius: 3px; margin: 5px auto 0; overflow: hidden; border: 1px solid #4a5568;}
        .health-bar { height: 100%; background-color: #48bb78; width: 100%; transition: width 0.5s ease; }
        .health-bar.low { background-color: #f56565; } .health-bar.medium { background-color: #faf089; }
        .damage-float { position: absolute; top: -20px; left: 50%; transform: translateX(-50%); font-size: 1.25rem; font-weight: bold; color: #e53e3e; animation: floatUp 1s ease-out forwards; opacity: 0; white-space: nowrap; }
        @keyframes floatUp { 0% { opacity: 1; top: -20px; } 100% { opacity: 0; top: -60px; } }

        .map-tile:hover { background-color: #4a5568; }
        .map-tile.explored { background-color: #3b475c; }
        .map-tile.unexplored { background-color: #222938; filter: brightness(0.7); }
        .map-tile.nanobot { background-color: #63b3ed !important; box-shadow: 0 0 8px #63b3ed; z-index:10; }
        .map-tile.base { background-color: #48bb78; } .map-tile.base::before {content: "🏠"; color: #1a202c;}
        .map-tile.resource-biomass::before { content: "🌿"; color: #9ae6b4; }
        .map-tile.resource-nanites::before { content: "⚙️"; color: #90cdf4; }
        .map-tile.resource-crystal::before { content: "💎"; color: #a7f3d0; }
        .map-tile.enemy::before { content: "💀"; color: #f56565; }
        .map-tile.upgrade::before { content: "💡"; color: #faf089; }

        .map-tile.unexplored { filter: brightness(0.6); }
        .map-tile.unexplored-impassable { background-color: #4a5568; }
        .map-tile.unexplored-impassable-crystal { background-color: #3b475c; }
        .map-tile.unexplored-flat { background-color: #222938; }
        .map-tile.unexplored-water { background-color: #1c3d52; }
        .map-tile.unexplored-rough { background-color: #373c48; }
        .map-tile.unexplored-ruin-outline::before { content: "🏛️"; opacity: 0.5; font-size: 1.1rem; display: flex; justify-content: center; align-items: center; width:100%; height:100%;}
        .map-tile.unexplored-large-crystal::before { content: "💠"; opacity: 0.5; font-size: 1.1rem; display: flex; justify-content: center; align-items: center; width:100%; height:100%;}
        .map-tile.unexplored-enemy-base-outline::before { content: "💢"; opacity: 0.6; font-size: 1.2rem; display:flex; justify-content:center; align-items:center; color: #e53e3e; width:100%; height:100%;}
        .map-tile.unexplored-distress-signal::before { content: "📡"; opacity: 0.6; font-size: 1.1rem; display:flex; justify-content:center; align-items:center; color: #faf089; width:100%; height:100%; animation: pulse-signal 2s infinite; }
        @keyframes pulse-signal { 0%, 100% { opacity: 0.4; } 50% { opacity: 0.8; } }

        .map-tile.explored-impassable { background-color: #718096; }
        .map-tile.explored-impassable-crystal { background-color: #5eead4; filter: brightness(0.9); }
        .map-tile.impassable-water.explored-impassable::before { content: "🌊"; opacity: 0.8; font-size: 1rem; display: flex; justify-content: center; align-items: center; width:100%; height:100%; color: #1e3a8a; }
        .map-tile.impassable-mountain.explored-impassable::before { content: "⛰️"; opacity: 0.8; font-size: 1rem; display: flex; justify-content: center; align-items: center; width:100%; height:100%; color: #4a5568;}

        .map-tile.grassland { background-color: #38a169; } .map-tile.grassland::before {content:"🌾"; color: #a7f3d0;}
        .map-tile.desert { background-color: #f6e05e; filter:brightness(0.8); } .map-tile.desert::before {content:"🏜️"; color: #d69e2e;}
        .map-tile.water { background-color: #63b3ed; } .map-tile.water::before {content:"💧"; color: #1c3d52;}
        .map-tile.forest { background-color: #2f855a; } .map-tile.forest::before {content:"🌳"; color: #9ae6b4;}
        .map-tile.mountain { background-color: #a0aec0; } .map-tile.mountain::before {content:"⛰️"; color: #4a5568;}
        .map-tile.ruins { background-color: #718096; } .map-tile.ruins::before {content:"🏛️"; color:#4a5568;}
        .map-tile.poi-structure::before { content:"🌟"; color:#faf089;}
        .map-tile.poi-wreckage::before { content:"⚓"; color:#a0aec0;}

        .map-tile.scanned { box-shadow: 0 0 5px yellow; animation: pulse-scan-border 1.5s infinite alternate; }
        @keyframes pulse-scan-border { from { box-shadow: 0 0 2px yellow; } to { box-shadow: 0 0 5px orange; } }
        .map-tile.scanned::after { position: absolute; opacity: 0.7; font-size:0.8em; left:50%; top:50%; transform: translate(-50%, -50%); z-index:1; pointer-events: none; }
        .map-tile.scanned.scanned-actual-biomass::after { content: "🌿"; color: #9ae6b4; }
        .map-tile.scanned.scanned-actual-nanites::after { content: "⚙️"; color: #90cdf4; }
        .map-tile.scanned.scanned-actual-crystal::after { content: "💎"; color: #a7f3d0; }
        .map-tile.scanned.scanned-actual-enemy::after { content: "💀"; color: #f56565; }
        .map-tile.scanned.scanned-actual-upgrade::after { content: "💡"; color: #faf089; }
        .map-tile.scanned.scanned-actual-enemy-base::after { content: "🏰"; color: #e53e3e; font-size: 1em; }
        .map-tile.scanned.scanned-actual-empty::after { content: "·"; color: #718096; font-size:1.1em; font-weight:bold; }
        .map-tile.scanned.scanned-actual-impassable-water::after { content: "🌊"; color: #63b3ed; opacity: 0.6; }
        .map-tile.scanned.scanned-actual-impassable-mountain::after { content: "⛰️"; color: #a0aec0; opacity: 0.6; }
        .map-tile.enemy-base::before { content: "🏰"; color: #e53e3e; font-size: 1.1rem; }
        .map-tile.has-active-resource {
            box-shadow: 0 0 8px 1px gold;
            animation: pulse-resource-highlight 1.5s infinite alternate;
            z-index: 2;
        }
        @keyframes pulse-resource-highlight {
            from { box-shadow: 0 0 5px 1px gold; }
            to { box-shadow: 0 0 10px 2px orange; }
        }
        .map-tile.resource-biomass::before,
        .map-tile.resource-nanites::before,
        .map-tile.resource-crystal::before {
            z-index: 3;
            position: relative;
        }

        /* Styles pour les Quêtes */
        #quests-content .quest-item { background-color: #384252; padding: 0.75rem; border-radius: 0.25rem; margin-bottom: 0.75rem; }
        #quests-content .quest-item h4 { color: #a0aec0; }
        #quests-content .quest-item p { color: #718096; font-size: 0.85em; }
        #quests-content .quest-item .objectives-list { list-style-type: disc; margin-left: 1.5rem; color: #90cdf4;}
        #quests-content .quest-item .objectives-list li.completed { text-decoration: line-through; color: #48bb78; }
        #quests-content .quest-item .rewards { margin-top: 0.5rem; font-size: 0.8em; color: #ecc94b; }
        #quests-content .quest-status-AVAILABLE { border-left: 4px solid #ecc94b; }
        #quests-content .quest-status-ACTIVE { border-left: 4px solid #4299e1; }
        #quests-content .quest-status-COMPLETED { border-left: 4px solid #48bb78; }
        #quests-content .quest-status-FINISHED { border-left: 4px solid #718096; opacity: 0.7; }
        #quests-content .quest-status-LOCKED { display: none; }

        .inventory-item, .shop-item { display: flex; justify-content: space-between; align-items: center; padding: 0.5rem; border-bottom: 1px solid #4a5568; }
        .inventory-item:last-child, .shop-item:last-child { border-bottom: none; }
        .item-details { flex-grow: 1; }
        .item-name { font-weight: bold; color: #a0aec0; }
        .item-stats { font-size: 0.8em; color: #718096; }

        .equipment-slot { display: flex; justify-content: space-between; align-items: center; padding: 0.5rem; margin-bottom: 0.5rem; background-color: #384252; border-radius: 0.25rem; }
        .slot-name { font-weight: bold; color: #90cdf4; }
        .equipped-item-name { color: #e2e8f0; }
        .empty-slot { color: #718096; font-style: italic; }

        #base-status-section { margin-top: 1rem; padding: 0.75rem; background-color: #384252; border-radius: 0.375rem; }
        #base-health-bar-container { width: 100%; height: 15px; background-color: #718096; border-radius: 5px; margin-top: 0.5rem; overflow: hidden; border: 1px solid #4a5568;}
        #base-health-bar { height: 100%; background-color: #48bb78; width: 100%; transition: width 0.5s ease; }
        .night-assault-active { border: 2px dashed #e53e3e !important; animation: pulse-danger 1s infinite alternate; }
        @keyframes pulse-danger { from { box-shadow: 0 0 10px #e53e3e; } to { box-shadow: 0 0 20px #c53030, 0 0 5px #e53e3e; } }

        #night-assault-enemies-display { display: flex; flex-wrap: wrap; gap: 5px; padding: 0.5rem; margin-top: 0.5rem; background-color: #1a202c; border-radius: 0.25rem; min-height: 30px; border: 1px solid #4a5568; }
        .assault-enemy-dot { width: 10px; height: 10px; background-color: #e53e3e; border-radius: 50%; box-shadow: 0 0 3px #c53030; animation: pulse-dot 1.5s infinite ease-in-out alternate; }
        .assault-enemy-dot.drone { background-color: #e53e3e; }
        .assault-enemy-dot.bot { background-color: #dd6b20; }
        .assault-enemy-dot.crawler { background-color: #d69e2e; }
        @keyframes pulse-dot { from { opacity: 0.7; transform: scale(0.9); } to { opacity: 1; transform: scale(1.1); } }

        #night-assault-log-container { margin-top: 1rem; }
        #night-assault-log { background-color: #1a202c; border: 1px solid #4a5568; border-radius: 0.375rem; padding: 0.75rem; height: 150px; overflow-y: auto; font-size: 0.8rem; color: #cbd5e0; font-family: 'Roboto Mono', monospace; line-height: 1.4; }
        #night-assault-log p { margin-bottom: 0.3rem; word-break: break-word; }
        #night-assault-log .text-orange-300 { color: #fbd38d; }
        #night-assault-log .text-red-400 { color: #fc8181; }
        #night-assault-log .text-green-400 { color: #9ae6b4; }
        #night-assault-log .text-teal-300 { color: #81e6d9; }

        #combat-log-visual { height: 150px; overflow-y: auto; background-color: #1a202c; padding: 0.75rem; border-radius: 0.25rem; font-size: 0.8rem; margin-top:1rem; border: 1px solid #4a5568; font-family: 'Roboto Mono', monospace; line-height: 1.4; }
        #combat-log-visual p { margin-bottom: 0.3rem; word-break: break-word; }
        .skill-activation { color: #faf089; font-weight: bold;}
        .skill-effect { color: #a0aec0; font-style: italic;}

        #base-preview-section {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #base-preview-container {
            max-width: 450px;
            max-height: 300px;
            width: 100%;
            aspect-ratio: calc(var(--base-grid-cols, 13) / var(--base-grid-rows, 9));
            background-color: #222938;
            border: 2px solid #4a5568;
            position: relative; /* Changé pour permettre le positionnement absolu des enfants */
            overflow: hidden;
            display: grid; /* Toujours une grille pour les cellules de fond */
        }
        .base-preview-cell {
            /* background-color: #222938; */ /* Laisser transparent pour voir le fond du conteneur */
            border: 1px dashed #4a5568; /* Bordure de la cellule */
            display: flex; /* Pour centrer le visuel du noyau */
            align-items: center;
            justify-content: center;
        }
        .base-preview-cell.core { background-color: transparent !important; } /* Noyau sur la cellule */
        .base-preview-cell.occupied { /* Plus besoin de couleur de fond ici, la tourelle couvrira */ }
        .base-preview-cell.placement-blocked { cursor: not-allowed; background-color: rgba(255,0,0,0.1); }
        .base-preview-cell.placement-active { cursor: copy; background-color: rgba(60,179,113,0.2); }
        .base-preview-cell.placement-active:hover { background-color: rgba(60,179,113,0.4); }

        .base-core-visual {
            width: 70%; /* Plus petit pour ne pas dépasser de sa cellule */
            height: 70%;
            background-color: #48bb78;
            border: 1px solid #38a169; /* Bordure plus fine */
            border-radius: 3px; /* Moins arrondi */
            color: #1a202c;
            font-weight: bold;
            font-size: 0.7rem; /* Adapté à la taille */
            display: flex;
            align-items: center;
            justify-content: center;
            /* margin: auto; est déjà géré par flex sur parent .base-preview-cell.core */
        }

        .defense-visual-on-grid {
            text-align: center;
            color: white;
            font-weight: bold;
            transition: background-color 0.3s ease, border-color 0.3s ease;
            z-index: 2;
            /* La taille (width/height) et la position (left/top) sont gérées par JS pour s'adapter à la cellule */
            /* La bordure sera définie par JS en fonction de la santé */
        }
        .defense-visual-on-grid.laserTurret {
             background-color: rgba(251, 211, 141, 0.4); /* Jaune-orange avec transparence de base */
        }
        .defense-visual-on-grid.gatlingTurret {
            background-color: rgba(203, 213, 224, 0.4); /* Gris clair avec transparence de base */
        }
        .defense-visual-on-grid.reinforcedWall {
            background-color: rgba(113, 128, 150, 0.5); /* Gris moyen avec transparence de base */
            font-size: 0.5rem !important;
            writing-mode: vertical-rl;
            text-orientation: mixed;
        }

        .base-enemy-visual {
            width: 7px; height: 7px;
            background-color: #e53e3e; border-radius: 50%; position: absolute;
            transition: transform 0.5s ease-out, left 0.5s linear, top 0.5s linear;
            box-shadow: 0 0 3px #c53030; z-index: 5;
            background-size: contain; background-repeat: no-repeat; background-position: center;
        }
        .boss-visual-dynamic {
            max-width: 28px; max-height: 28px;
            background-color: #7f1d1d; border: 2px solid gold; border-radius: 3px;
            box-shadow: 0 0 8px gold; z-index: 6;
            background-size: contain; background-repeat: no-repeat; background-position: center;
        }
        .base-enemy-visual.drone { background-color: #e53e3e; }
        .base-enemy-visual.bot { background-color: #dd6b20; }
        .base-enemy-visual.crawler { background-color: #d69e2e; }
        .laser-beam { position: absolute; background-color: #fbd38d; height: 2px; opacity: 0.8; transform-origin: 0 50%; z-index: 10; pointer-events: none; box-shadow: 0 0 5px #fbd38d, 0 0 10px #e9ab54; }

        /* STYLES POUR LA VIDÉO */
        #night-assault-video-container {
            background-color: rgba(0,0,0,0.9);
            z-index: 1005;
        }
        #night-assault-video {
            max-width: 90vw;
            max-height: 90vh;
            border: 3px solid #e53e3e;
            box-shadow: 0 0 25px #c53030;
        }
    </style>
</head>
<body class="p-4">

    <div id="toggle-menu-btn-container">
        <button id="toggle-menu-btn" class="btn btn-sm">☰ Menu</button>
    </div>

    <header class="resource-bar p-4 mb-4 flex flex-wrap justify-between items-center">
        <h1 id="page-title-h1" class="font-orbitron text-3xl text-blue-400">Nexus-7: Genesis</h1>
        <div class="flex space-x-4 md:space-x-6 items-center mt-2 md:mt-0">
            <div><span class="font-semibold">Biomasse:</span> <span id="biomass">0</span> (+<span id="biomassRate">0</span>/s)</div>
            <div><span class="font-semibold">Nanites:</span> <span id="nanites">0</span> (+<span id="nanitesRate">0</span>/s)</div>
            <div id="crystal-shards-display-container" class="hidden"><span class="font-semibold">Cristaux:</span> <span id="crystal_shards">0</span></div>
            <div><span class="font-semibold">Énergie:</span> <span id="energy">0</span> (<span id="energyCostMove">0</span>/mouv.)</div>
        </div>
        <div class="flex items-center space-x-4">
            <div id="base-health-display" class="text-sm"><span class="font-semibold">Base:</span> <span id="base-health-value">0</span> / <span id="base-max-health-value">0</span></div>
            <div><span class="font-semibold">Cycle:</span> <span id="cycleStatus">Jour</span> (<span id="gameTime">00:00</span>)</div>
        </div>
    </header>

    <main class="main-content-wrapper p-4">
        <section id="buildings-section" class="panel">
             <h2 class="font-orbitron text-xl mb-3 text-blue-300 border-b border-gray-600 pb-2">Modules Structurels & Défensifs</h2>
             <!-- Le contenu des bâtiments sera injecté ici par JS -->
        </section>

        <div id="main-view-section-container">
            <section id="main-view-section" class="panel">
                <div class="flex border-b border-gray-600 mb-3 flex-wrap">
                    <button id="tab-overview" class="font-orbitron py-2 px-4 text-lg focus:outline-none border-b-2 border-blue-400 text-blue-300">Noyau</button>
                    <button id="tab-research" class="font-orbitron py-2 px-4 text-lg focus:outline-none text-gray-500 hover:text-blue-300">R&D</button>
                    <button id="tab-nanobot" class="font-orbitron py-2 px-4 text-lg focus:outline-none text-gray-500 hover:text-blue-300">Nexus-7</button>
                    <button id="tab-exploration" class="font-orbitron py-2 px-4 text-lg focus:outline-none text-gray-500 hover:text-blue-300">Exploration</button>
                    <button id="tab-quests" class="font-orbitron py-2 px-4 text-lg focus:outline-none text-gray-500 hover:text-blue-300">Quêtes</button>
                    <button id="tab-inventory" class="font-orbitron py-2 px-4 text-lg focus:outline-none text-gray-500 hover:text-blue-300">Inventaire</button>
                    <button id="tab-shop" class="font-orbitron py-2 px-4 text-lg focus:outline-none text-gray-500 hover:text-blue-300">Boutique</button>
                </div>

                <div id="overview-content">
                    <h2 class="font-orbitron text-xl mb-3 text-blue-300">Statut du Noyau</h2>
                    <p class="mb-2">Le Noyau Central est le cœur de vos opérations et doit être protégé à tout prix.</p>
                    <div id="base-status-section">
                        <h3 class="font-orbitron text-lg text-yellow-300">Intégrité Structurelle du Noyau</h3>
                        <div class="flex justify-between items-center text-sm mb-1">
                            <span>PV Noyau: <span id="overview-base-health">N/A</span></span>
                            <span id="base-defense-power">Puissance Défensive: 0</span>
                        </div>
                        <div id="base-health-bar-container">
                            <div id="base-health-bar" class="health-bar"></div>
                        </div>
                        <h4 class="font-orbitron text-sm text-red-400 mt-3 mb-1">Menaces Actives:</h4>
                        <div id="night-assault-enemies-display">
                            <p class="text-gray-500 italic text-xs">Aucune menace détectée pour le moment.</p>
                        </div>
                        <div class="mt-3 flex space-x-2">
                            <button id="repair-base-btn" class="btn btn-success btn-sm">Réparer Noyau</button>
                            <button id="repair-defenses-btn" class="btn btn-info btn-sm">Réparer Défenses</button>
                        </div>
                        <div class="mt-3">
                            <button id="force-cycle-change-btn" class="btn btn-info btn-sm w-full">Forcer Changement de Cycle</button>
                        </div>
                        <div id="active-defenses-display" class="mt-2 text-xs text-gray-400">
                            <strong>Aucune défense active.</strong>
                        </div>
                    </div>
                    <div id="base-preview-section" class="my-4">
                        <h3 class="font-orbitron text-lg text-blue-300 mb-2 text-center">Schéma Défensif du Noyau</h3>
                        <div id="base-preview-container"></div>
                        <div id="placement-info" class="text-center text-sm text-yellow-400 mt-2 hidden">
                            Mode Placement Actif. Sélectionnez une case pour construire <span id="selected-defense-for-placement" class="font-bold"></span>.
                            <button id="cancel-placement-btn" class="btn btn-danger btn-xs ml-2">Annuler</button>
                        </div>
                    </div>
                    <img id="core-image" src="https://placehold.co/600x200/1a202c/e2e8f0?text=Noyau+Central+Nexus-7&fontsize=24"
                        alt="Vue du Noyau Central" class="mx-auto rounded-lg shadow-md my-4 max-w-full h-auto" style="max-height: 200px; object-fit: cover;">
                    <div id="night-assault-log-container">
                        <h3 class="font-orbitron text-lg mb-2 text-red-300 border-b border-gray-600 pb-1">Journal d'Assaut Nocturne</h3>
                        <div id="night-assault-log">
                            <p class="text-gray-500 italic">En attente d'événements...</p>
                        </div>
                    </div>
                    <div id="event-log" class="mt-4 p-3 bg-gray-700 rounded h-40 overflow-y-auto text-sm">
                        <h3 class="font-semibold mb-2 text-gray-300">Journal Principal des Événements :</h3>
                    </div>
                </div>

                <div id="research-content" class="hidden">
                    <h2 class="font-orbitron text-xl mb-3 text-blue-300 border-b border-gray-600 pb-2">Arbre Technologique</h2>
                </div>

                <div id="nanobot-content" class="hidden">
                    <h2 class="font-orbitron text-xl mb-3 text-blue-300">Configuration Nexus-7</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <h3 class="font-orbitron text-lg mb-2 text-blue-200">Visualisation</h3>
                            <div id="nanobot-visual-container" class="nanobot-display">
                                <div id="nanobot-body" class="nanobot-core"></div>
                            </div>
                            <div id="equipped-items-display-brief" class="mt-1 text-sm text-center text-gray-400"></div>
                            <div id="equipped-modules-display" class="mt-4"></div>
                        </div>
                        <div>
                            <h3 class="font-orbitron text-lg mb-2 text-blue-200">Statistiques</h3>
                            <ul class="space-y-1 text-sm">
                                <li>Santé: <span id="nanobot-health" class="font-semibold">0</span></li>
                                <li>Attaque: <span id="nanobot-attack" class="font-semibold">0</span></li>
                                <li>Défense: <span id="nanobot-defense" class="font-semibold">0</span></li>
                                <li>Vitesse: <span id="nanobot-speed" class="font-semibold">0</span></li>
                            </ul>
                            <h3 class="font-orbitron text-lg mt-4 mb-2 text-blue-200">Actions Spéciales</h3>
                            <button id="toggle-nanobot-defend-base-btn" class="btn btn-secondary w-full mb-2">Activer Défense du Noyau</button>
                            <button id="simulate-combat-btn" class="btn btn-danger w-full">Simuler Combat (Test)</button>
                            <div id="combat-log-summary" class="mt-2 p-2 bg-gray-700 rounded h-24 overflow-y-auto text-xs">
                                <h4 class="font-semibold mb-1 text-gray-300">Résumé Combat :</h4>
                            </div>
                        </div>
                    </div>
                    <div class="mt-6">
                        <h3 class="font-orbitron text-lg mb-2 text-blue-200">Équipement Actuel</h3>
                        <div id="nanobot-equipment-slots" class="space-y-2"></div>
                    </div>
                </div>

                <div id="inventory-content" class="hidden">
                    <h2 class="font-orbitron text-xl mb-3 text-blue-300">Inventaire des Objets</h2>
                    <ul id="inventory-list" class="space-y-1 text-sm text-gray-300"></ul>
                </div>

                <div id="shop-content" class="hidden">
                    <h2 class="font-orbitron text-xl mb-3 text-blue-300">Marché de Ravitaillement X-9</h2>
                    <p class="text-sm text-gray-400 mb-4">Les drones marchands proposent occasionnellement des améliorations et composants rares. Les stocks sont limités.</p>
                    <div id="shop-items-list" class="space-y-2"></div>
                </div>

                <div id="exploration-content" class="hidden">
                    <h2 id="exploration-title" class="font-orbitron text-xl mb-3 text-blue-300">Carte d'Exploration</h2>

                    <div id="exploration-layout" class="flex flex-col md:flex-row gap-4">

                        <div id="exploration-main-column" class="flex-grow md:w-3/4 order-2 md:order-1">
                            <div id="zone-selection-container" class="mb-4 p-3 bg-gray-700 rounded">
                                <h3 class="font-orbitron text-lg text-blue-300 mb-2">Sélection de Zone</h3>
                                <div id="zone-list" class="space-y-2"></div>
                            </div>
                            <div id="exploration-map-area">
                                <div id="exploration-content-container">
                                    <!-- Bouton Scan sera inséré ici par JS -->
                                    <div id="map-grid"></div>
                                </div>
                            </div>
                            <div id="map-info" class="mt-3 text-center">
                                <p>Position: <span id="nanobot-map-pos">N/A</span>. <span class="text-sm text-gray-400">(Énergie/Dépl.: <span id="exploration-move-gauge">?</span>)</span></p>
                                <p id="tile-info-display" class="text-gray-400 italic">Survolez une case pour plus d'infos.</p>
                            </div>
                        </div>

                        <div id="exploration-sidebar" class="flex flex-col md:w-1/4 order-1 md:order-2">
                            <h3 class="font-orbitron text-lg text-yellow-300 mb-2 border-b border-gray-600 pb-1">Journal d'Exploration</h3>
                            <div id="exploration-log" class="mb-4">
                                <p class="text-gray-500 italic">Aucun événement d'exploration récent...</p>
                            </div>

                            <div id="tile-interaction-panel">
                                <!-- Le titre sera ajouté par JS dans updateTileInteractionPanel -->
                                <div id="tile-interaction-details">
                                    <p class="text-gray-500 italic">Cliquez sur une case pour interagir.</p>
                                </div>
                                <div id="tile-interaction-actions"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="quests-content" class="hidden">
                    <h2 class="font-orbitron text-xl mb-3 text-blue-300 border-b border-gray-600 pb-2">Journal des Quêtes</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <h3 class="font-orbitron text-lg text-yellow-300 mb-2">Quêtes Actives & Disponibles</h3>
                            <div id="active-quests-list" class="space-y-3">
                                <p class="text-gray-500 italic">Aucune quête active ou disponible.</p>
                            </div>
                        </div>
                        <div>
                            <h3 class="font-orbitron text-lg text-gray-500 mb-2">Quêtes Terminées</h3>
                            <div id="completed-quests-list" class="space-y-3">
                                <p class="text-gray-500 italic">Aucune quête terminée.</p>
                            </div>
                        </div>
                    </div>
                </div>

            </section>
        </div>
    </main>

    <footer class="footer p-3 mt-4 text-center text-sm"> <p>&copy; 2025 Nexus-7: Genesis.</p> </footer>

    <div id="modal" class="modal hidden"><div class="modal-content"><h3 id="modal-title" class="font-orbitron text-lg mb-4">Titre Modale</h3><p id="modal-message" class="mb-6">Message Modale.</p><div class="flex justify-end space-x-3"><button id="modal-cancel" class="btn btn-secondary">Annuler</button><button id="modal-confirm" class="btn btn-primary">Confirmer</button></div></div></div>
    <div id="combat-modal" class="modal hidden"><div id="combat-modal-content" class="modal-content"><h2 class="font-orbitron text-2xl mb-4 text-center text-red-400">Affrontement !</h2><div class="combat-arena"><div id="combat-nanobot" class="combatant"><div class="combatant-name">Nexus-7</div><div class="combatant-sprite" id="combat-nanobot-sprite"></div><div class="health-bar-container"><div id="combat-nanobot-healthbar" class="health-bar"></div></div></div><div id="combat-enemy" class="combatant"><div class="combatant-name" id="combat-enemy-name">Ennemi</div><div class="combatant-sprite" id="combat-enemy-sprite"></div><div class="health-bar-container"><div id="combat-enemy-healthbar" class="health-bar"></div></div></div></div><div id="combat-log-visual"></div><div class="text-center mt-4"><button id="close-combat-modal-btn" class="btn btn-secondary">Fermer</button><button id="toggle-speed-btn" class="btn btn-secondary ml-2">Vitesse x3</button></div></div></div>
    <div id="combat-end-modal" class="modal hidden"><div class="modal-content text-center"><h3 id="combat-end-title" class="font-orbitron text-lg mb-4 text-green-300">Victoire !</h3><p id="combat-end-rewards" class="mb-2 text-sm"></p><h4 class="text-blue-300 mt-4 mb-1 font-orbitron">XP & Niveau</h4><p id="xp-gain" class="text-sm mb-2"></p><div class="w-full bg-gray-700 rounded-full h-2.5 mb-2"><div id="xp-bar" class="bg-blue-500 h-2.5 rounded-full" style="width: 0%"></div></div><h4 class="text-yellow-300 mt-4 mb-1 font-orbitron">Butin Obtenu</h4><ul id="loot-list" class="text-sm text-gray-300 list-disc list-inside mb-4"></ul><button id="close-end-modal" class="btn btn-primary mt-4">Fermer</button></div></div>

    <!-- NOUVELLE MODALE VIDÉO -->
    <div id="night-assault-video-container" class="modal hidden">
        <div class="relative">
            <video id="night-assault-video" width="80%" height="auto" preload="auto">
                <!-- Remplacez par le chemin réel de VOTRE vidéo -->
                <source src="videos/night_assault_alert.mp4" type="video/mp4">
                Votre navigateur ne supporte pas l'élément vidéo.
            </video>
            <button id="close-night-assault-video-btn" class="btn btn-danger btn-sm" style="position: absolute; top: 10px; right: 10px; z-index: 10;">Fermer [X]</button>
        </div>
    </div>

<script src="js/config.js"></script>
<script src="js/gameState.js"></script>
<script src="js/utils.js"></script>
<script src="js/mapManager.js"></script>
<script src="js/explorationController.js"></script>
<script src="js/explorationUI.js"></script>
<script src="js/questController.js"></script>
<script src="js/questUI.js"></script>
<script src="js/inventoryShop.js"></script>
<script src="js/combat.js"></script>
<script src="js/gameplayLogic.js"></script>
<script src="js/uiUpdates.js"></script>
<script src="js/main.js" defer></script>

</body>
</html>